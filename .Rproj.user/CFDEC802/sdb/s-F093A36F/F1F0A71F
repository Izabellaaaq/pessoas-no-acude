{
    "collab_server" : "",
    "contents" : "\nlibrary(dplyr)\n\n\najeita.formato <- function(df, primeiras.linhas = 0, ultimas.linhas = 0, primeiras.colunas = 0, ultimas.colunas = 0) {\n  df %>%\n    rename(horario.inicial = X, horario.final = X.1) %>%\n    head(nrow(.)-ultimas.linhas) %>%\n    tail(nrow(.)-primeiras.linhas) %>%\n    select(., one_of(names(.[(primeiras.colunas+1):(ncol(.)-ultimas.colunas)]))) %>%\n    mutate(total = rowSums(.[grep(names(.), pattern = 'trajeto\\\\.[0-9]+')]))\n}\n\nfiltra.colunas <- function(df, colunas, local) {\n  local <- gsub('([a-z]+)\\\\.[a-z]+', '\\\\1', local)\n  cbind(select(df, which(names(df) %in% colunas)),\n        local = local)\n}\n\njunta.dfs <- function(categoria) {\n  df <- data.frame()\n  nomes.dfs.filtrados <- subset(nomes.dfs, grepl(paste0('\\\\.', categoria), nomes.dfs))\n  colunas.categoria <- subset(nomes.colunas, grepl(paste0('\\\\.', categoria), nomes.colunas))\n  for(nome in nomes.dfs.filtrados) {\n    df <- rbind(df, filtra.colunas(get(nome), get(colunas.categoria), nome))\n  }\n  df\n}\n\n\nbobs.carros <- read.csv('dados/brutos/Contagens Açude Velho - Bob´s - Carros.csv') %>%\n  ajeita.formato(ultimas.linhas = 1, ultimas.colunas = 2) %>%\n  rename(onibus = ônibus, caminhao = caminhão)\n\nbobs.ciclistas <- read.csv('dados/brutos/Contagens Açude Velho - Bob´s - Ciclistas.csv') %>%\n  ajeita.formato(ultimas.linhas = 2, ultimas.colunas = 1) %>%\n  mutate(calcada = NA) %>%\n  subset(select=c(horario.inicial:mulher, calcada, total))\n\nbobs.motos <- read.csv('dados/brutos/Contagens Açude Velho - Bob´s - Motos.csv') %>%\n  ajeita.formato(ultimas.linhas = 1, ultimas.colunas = 1)\n\nbobs.pedestres <- read.csv('dados/brutos/Contagens Açude Velho - Bob´s - Pedestres.csv') %>%\n  ajeita.formato(ultimas.linhas = 2, ultimas.colunas = 1)\n\nburrinhos.carros <- read.csv('dados/brutos/Contagens Açude Velho - Burrinhos - Carros.csv') %>%\n  ajeita.formato(primeiras.linhas = 1, ultimas.linhas = 1, ultimas.colunas = 2) %>%\n  rename(onibus = ônibus, caminhao = caminhão)\n\nburrinhos.ciclistas <- read.csv('dados/brutos/Contagens Açude Velho - Burrinhos - Ciclistas.csv') %>%\n  ajeita.formato(primeiras.linhas = 1, ultimas.linhas = 1) %>%\n  rename(mulher = Mulher, calcada = Calçada)\nburrinhos.ciclistas[22,3:ncol(burrinhos.ciclistas)] <- 0\n\nburrinhos.motos <- read.csv('dados/brutos/Contagens Açude Velho - Burrinhos - Motos.csv') %>%\n  ajeita.formato(ultimas.linhas = 1, ultimas.colunas = 2)\n\nburrinhos.pedestres <- read.csv('dados/brutos/Contagens Açude Velho - Burrinhos - Pedestres.csv') %>%\n  mutate(trajeto.8 = as.integer(replace(trajeto.8, trajeto.8 == 'protesto', NA))) %>%\n  mutate(trajeto.8 = replace(trajeto.8, is.na(trajeto.8), max(trajeto.8, na.rm = T))) %>%\n  mutate(trajeto.9 = as.integer(replace(trajeto.9, trajeto.9 == 'protesto', NA))) %>%\n  mutate(trajeto.9 = replace(trajeto.9, is.na(trajeto.9), max(trajeto.9, na.rm = T))) %>%\n  mutate(trajeto.12 = as.integer(replace(trajeto.12, trajeto.12 == 'protesto', NA))) %>%\n  mutate(trajeto.12 = replace(trajeto.12, is.na(trajeto.12), max(trajeto.12, na.rm = T))) %>%\n  mutate(trajeto.13 = as.integer(replace(trajeto.13, trajeto.13 == 'protesto', NA))) %>%\n  mutate(trajeto.13 = replace(trajeto.13, is.na(trajeto.13), max(trajeto.13, na.rm = T))) %>%\n  ajeita.formato(ultimas.linhas = 2, ultimas.colunas = 1)\n\njackson.carros <- read.csv('dados/brutos/Contagens Açude Velho - Jackson - Carros.csv') %>%\n  ajeita.formato(ultimas.linhas = 1, ultimas.colunas = 1) %>%\n  rename(onibus = ônibus, caminhao = caminhão)\n\njackson.ciclistas <- read.csv('dados/brutos/Contagens Açude Velho - Jackson - Ciclistas.csv') %>%\n  ajeita.formato(ultimas.linhas = 2, ultimas.colunas = 1) %>%\n  rename(calcada = na.calçada)\n\njackson.motos <- read.csv('dados/brutos/Contagens Açude Velho - Jackson - Motos.csv') %>%\n  ajeita.formato(ultimas.linhas = 1, ultimas.colunas = 1)\n\njackson.pedestres <- read.csv('dados/brutos/Contagens Açude Velho - Jackson - Pedestres.csv') %>%\n  ajeita.formato(ultimas.linhas = 2, ultimas.colunas = 1) %>%\n  mutate(fora.da.faixa = replace(fora.da.faixa, is.na(fora.da.faixa), 0)) %>%\n  mutate(cachorro = as.integer(as.character(cachorro))) %>%\n  mutate(cachorro = replace(cachorro, is.na(cachorro), 0))\n\n\n# Nomes das colunas presentes em cada tipo de data.frame\ncolunas.base <- c('horario.inicial', 'horario.final', 'total')\ncolunas.carros <- c(colunas.base, 'caminhao', 'onibus')\ncolunas.ciclistas <- c(colunas.base, 'mulher', 'calcada')\ncolunas.motos <- colunas.base\ncolunas.pedestres <- c(colunas.base, 'mulher', 'cachorro')\n\n\n# Vetores com os nomes das variáveis\nnomes.colunas <- names(which(unlist(eapply(.GlobalEnv, is.character)))) %>%\n  subset(., grepl('colunas\\\\.', .))\nnomes.dfs <- names(which(unlist(eapply(.GlobalEnv, is.data.frame))))\n\n# Juntando dfs de vários locais para uma só categoria\ncarros <- junta.dfs('carros')\nciclistas <- junta.dfs('ciclistas')\nmotos <- junta.dfs('motos')\npedestres <- junta.dfs('pedestres')\n",
    "created" : 1498680995222.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "152068185",
    "id" : "F1F0A71F",
    "lastKnownWriteTime" : 1498708512,
    "last_content_update" : 1498708512181,
    "path" : "~/Projetos/lab-rua/pessoas-no-acude/src/juntador.R",
    "project_path" : "src/juntador.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}